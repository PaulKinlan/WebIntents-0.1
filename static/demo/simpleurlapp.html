<html>
  <head>
    <script src="/lib/client.js"></script>
    
    <script>
      
      window.addEventListener("load", function() {
        window.channel.initialize(function() {});
        var urls = document.getElementById("urls");
        var go = document.getElementById("go");
        var intentContainer = document.getElementById("intents");
        go.addEventListener("click", function() {
          window.channel.discover("SHORTEN", {}, function(data) {
            
            // handle the list of intents that can handle this, if we know it 
            // already then we can just use that one.
            var intents = data.intents;
            for(var intent in intents) {
              var d = document.createElement("div");
              d.innerText = data.intents[intent].data.name;
              d.method = data.intents[intent].method;
              d.addEventListener("click", function(e) {
                var method = d.method;
                // send the message.
                var url = urls.value;
                
                // We know the app that we want to send the message to so do it
                window.channel.send(
                  method,
                  {
                    "data" : url
                  }, 
                  function(data) {
                    // This is the response from the app that we sent a message to
                  });
              });
              
              intentContainer.appendChild(d);
            }
          });
          
          // Until a service has been chosen then there is nothing other than 
          // discovery.
          
        });
        
      });
    </script>
  </head>
  <body>
    <h1>Reference Application - Uses a URL Shortener</h1>
    <p>This is a reference application for an app that will use a registered  URL shortener.</p>
    
    <input type="urls" placeholder="Enter your URL" id="urls" />
    <input type="button" id="go" value="Go">
      
    <div>Select a service to use (it only works if you click on a service):</div>
    <div id="intents">

    </div>
    
    <h3>Results</h3>
    <p>Results will appear here.</p>
    <div id="results">
    </div>
    
  </body>
</html>